{"version":3,"sources":["../../src/loaders/bitmapFontParser.js"],"names":["parse","bitmapFontParser","resource","next","data","type","Resource","TYPE","XML","getElementsByTagName","length","getAttribute","xmlUrl","isDataUrl","path","dirname","url","baseUrl","charAt","replace","textureUrl","utils","TextureCache","loadOptions","crossOrigin","loadType","LOAD_TYPE","IMAGE","metadata","imageMetadata","parentResource","add","name","res","texture","bitmapFont","BitmapText","registerFont"],"mappings":";;;QAagBA,K,GAAAA,K;;kBAKD,YACf;AACI,WAAO,SAASC,gBAAT,CAA0BC,QAA1B,EAAoCC,IAApC,EACP;AACI;AACA,YAAI,CAACD,SAASE,IAAV,IAAkBF,SAASG,IAAT,KAAkBC,yBAASC,IAAT,CAAcC,GAAtD,EACA;AACIL;;AAEA;AACH;;AAED;AACA,YAAID,SAASE,IAAT,CAAcK,oBAAd,CAAmC,MAAnC,EAA2CC,MAA3C,KAAsD,CAAtD,IACGR,SAASE,IAAT,CAAcK,oBAAd,CAAmC,MAAnC,EAA2CC,MAA3C,KAAsD,CADzD,IAEGR,SAASE,IAAT,CAAcK,oBAAd,CAAmC,MAAnC,EAA2C,CAA3C,EAA8CE,YAA9C,CAA2D,MAA3D,MAAuE,IAF9E,EAIA;AACIR;;AAEA;AACH;;AAED,YAAIS,SAAS,CAACV,SAASW,SAAV,GAAsBC,KAAKC,OAAL,CAAab,SAASc,GAAtB,CAAtB,GAAmD,EAAhE;;AAEA,YAAId,SAASW,SAAb,EACA;AACI,gBAAID,WAAW,GAAf,EACA;AACIA,yBAAS,EAAT;AACH;;AAED,gBAAI,KAAKK,OAAL,IAAgBL,MAApB,EACA;AACI;AACA,oBAAI,KAAKK,OAAL,CAAaC,MAAb,CAAoB,KAAKD,OAAL,CAAaP,MAAb,GAAsB,CAA1C,MAAiD,GAArD,EACA;AACIE,8BAAU,GAAV;AACH;;AAED;AACAA,yBAASA,OAAOO,OAAP,CAAe,KAAKF,OAApB,EAA6B,EAA7B,CAAT;AACH;AACJ;;AAED;AACA,YAAIL,UAAUA,OAAOM,MAAP,CAAcN,OAAOF,MAAP,GAAgB,CAA9B,MAAqC,GAAnD,EACA;AACIE,sBAAU,GAAV;AACH;;AAED,YAAMQ,aAAaR,SAASV,SAASE,IAAT,CAAcK,oBAAd,CAAmC,MAAnC,EAA2C,CAA3C,EAA8CE,YAA9C,CAA2D,MAA3D,CAA5B;;AAEA,YAAIU,YAAMC,YAAN,CAAmBF,UAAnB,CAAJ,EACA;AACI;AACApB,kBAAME,QAAN,EAAgBmB,YAAMC,YAAN,CAAmBF,UAAnB,CAAhB;AACAjB;AACH,SALD,MAOA;AACI,gBAAMoB,cAAc;AAChBC,6BAAatB,SAASsB,WADN;AAEhBC,0BAAUnB,yBAASoB,SAAT,CAAmBC,KAFb;AAGhBC,0BAAU1B,SAAS0B,QAAT,CAAkBC,aAHZ;AAIhBC,gCAAgB5B;AAJA,aAApB;;AAOA;AACA,iBAAK6B,GAAL,CAAY7B,SAAS8B,IAArB,aAAmCZ,UAAnC,EAA+CG,WAA/C,EAA4D,UAACU,GAAD,EAC5D;AACIjC,sBAAME,QAAN,EAAgB+B,IAAIC,OAApB;AACA/B;AACH,aAJD;AAKH;AACJ,KAzED;AA0EH,C;;AA9FD;;IAAYW,I;;AACZ;;AACA;;AACA;;;;AAEA;;;;;;;;AAQO,SAASd,KAAT,CAAeE,QAAf,EAAyBgC,OAAzB,EACP;AACIhC,aAASiC,UAAT,GAAsBC,mBAAWC,YAAX,CAAwBnC,SAASE,IAAjC,EAAuC8B,OAAvC,CAAtB;AACH","file":"bitmapFontParser.js","sourcesContent":["import * as path from 'path';\nimport { utils } from '../core';\nimport { Resource } from 'resource-loader';\nimport { BitmapText } from '../extras';\n\n/**\n * Register a BitmapText font from loader resource.\n *\n * @function parseBitmapFontData\n * @memberof PIXI.loaders\n * @param {PIXI.loaders.Resource} resource - Loader resource.\n * @param {PIXI.Texture} texture - Reference to texture.\n */\nexport function parse(resource, texture)\n{\n    resource.bitmapFont = BitmapText.registerFont(resource.data, texture);\n}\n\nexport default function ()\n{\n    return function bitmapFontParser(resource, next)\n    {\n        // skip if no data or not xml data\n        if (!resource.data || resource.type !== Resource.TYPE.XML)\n        {\n            next();\n\n            return;\n        }\n\n        // skip if not bitmap font data, using some silly duck-typing\n        if (resource.data.getElementsByTagName('page').length === 0\n            || resource.data.getElementsByTagName('info').length === 0\n            || resource.data.getElementsByTagName('info')[0].getAttribute('face') === null\n        )\n        {\n            next();\n\n            return;\n        }\n\n        let xmlUrl = !resource.isDataUrl ? path.dirname(resource.url) : '';\n\n        if (resource.isDataUrl)\n        {\n            if (xmlUrl === '.')\n            {\n                xmlUrl = '';\n            }\n\n            if (this.baseUrl && xmlUrl)\n            {\n                // if baseurl has a trailing slash then add one to xmlUrl so the replace works below\n                if (this.baseUrl.charAt(this.baseUrl.length - 1) === '/')\n                {\n                    xmlUrl += '/';\n                }\n\n                // remove baseUrl from xmlUrl\n                xmlUrl = xmlUrl.replace(this.baseUrl, '');\n            }\n        }\n\n        // if there is an xmlUrl now, it needs a trailing slash. Ensure that it does if the string isn't empty.\n        if (xmlUrl && xmlUrl.charAt(xmlUrl.length - 1) !== '/')\n        {\n            xmlUrl += '/';\n        }\n\n        const textureUrl = xmlUrl + resource.data.getElementsByTagName('page')[0].getAttribute('file');\n\n        if (utils.TextureCache[textureUrl])\n        {\n            // reuse existing texture\n            parse(resource, utils.TextureCache[textureUrl]);\n            next();\n        }\n        else\n        {\n            const loadOptions = {\n                crossOrigin: resource.crossOrigin,\n                loadType: Resource.LOAD_TYPE.IMAGE,\n                metadata: resource.metadata.imageMetadata,\n                parentResource: resource,\n            };\n\n            // load the texture for the font\n            this.add(`${resource.name}_image`, textureUrl, loadOptions, (res) =>\n            {\n                parse(resource, res.texture);\n                next();\n            });\n        }\n    };\n}\n"]}